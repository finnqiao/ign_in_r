---
title: "Analysis of IGN dataset in R"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
setwd("/Users/finn/medium_articles/ign_in_r")
getwd()
```

```{r}
# install tidyverse and readr for data manipulation
install.packages("tidyverse", dependencies=TRUE, repos="http://cran.wustl.edu/")
```


```{r}
# install.packages("readr", dependencies=TRUE)
```

```{r}
# install.packages("here", dependencies = TRUE)
```


```{r}
# load packages
library(tidyverse)
library(readr)
```

```{r}
# read csv of ign data into a dataframe
ign <- read.csv(here::here('ign.csv'), stringsAsFactors = FALSE)
head(ign)
```

```{r}
# a summary of the variables in the dataframe
str(ign)
summary(ign)
```

```{r}
names(ign)
```

Top-rated titles
```{r}
ign[order(ign$score, decreasing = TRUE),]
```

Top-rated genre
```{r}
ign %>%
  group_by(genre) %>%
  summarise(mean_score = mean(score)) %>%
  arrange(desc(mean_score)) %>%
  head(., n=10) %>%
  ggplot() +
  geom_bar(aes(x=reorder(genre, -mean_score), y=mean_score, fill=genre), stat="identity") +
  geom_label(aes(x=reorder(genre, -mean_score), y=mean_score, label = round(mean_score,digits = 2))) +
  guides(fill = FALSE) +
  labs(title = "Top 10 Genres by Mean Review Score", x="Genre", y="Mean Review Score") +
  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1))
```

Top-rated platforms
```{r}
ign %>%
  group_by(platform) %>%
  summarise(mean_score = mean(score)) %>%
  arrange(desc(mean_score)) %>%
  head(., n=10) %>%
  ggplot() +
  geom_bar(aes(x=reorder(platform, -mean_score), y=mean_score, fill = platform), stat="identity") +
  geom_label(aes(x=reorder(platform, -mean_score), y=mean_score, label=round(mean_score, digits = 2))) +
  labs(title = "Top 10 Platforms by Mean Review Score", x="Platform", y="Mean Review Score") +
  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1)) + 
  guides(fill = FALSE)
```

Number of Games in Each Platform

```{r}
ign %>%
  group_by(platform) %>%
  summarise(counts = n()) %>%
  arrange(desc(counts)) %>%
  head(., n=10) %>%
  ggplot() +
  geom_bar(aes(x=reorder(platform, -counts), y=counts, fill=platform), stat="identity") +
  geom_label(aes(x=reorder(platform, -counts), y=counts, label = counts)) + 
  labs(title = "Top 10 Platforms by Number of Games", x="Platform", y="Total Number of Games") +
  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1)) + 
  guides(fill = FALSE)
```

String split function
```{r}
# string split function to get the main game genre
get_genre <- function(string) {
  length <- sapply(strsplit(string, ","), length)
  return(sapply(strsplit(string,","), function(x) x[1]))
}
get_genre("Compilation, Compilation")
```

Consolidating genres
```{r}
# creating new column for main genre based on above created function
ign$main_genre <- get_genre(ign$genre)
unique(ign$main_genre)
```

Dropping NA values
```{r}
# games that dont have a genre
ign[is.na(ign$main_genre),]
```

```{r}
# checking to see if NA are dropped
ign <- ign[!is.na(ign$main_genre),]
dim(ign)
```

```{r}
# checking for any other missing values
apply(ign, 2, function(x) any(is.na(x)))
```

```{r}
ign %>%
  group_by(main_genre) %>%
  summarise(mean_score = mean(score)) %>%
  arrange(desc(mean_score)) %>%
  head(., n=10) %>%
  ggplot() +
  geom_bar(aes(x=reorder(main_genre, -mean_score), y=mean_score, fill = main_genre), stat="identity") +
  labs(title = "Top 10 Main Genres by Mean Review Score", x="Main Genre", y="Mean Review Score") +
  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1)) + 
  guides(fill = FALSE)
```

```{r}
ign %>%
  group_by(main_genre) %>%
  summarise(mean_score = mean(score)) %>%
  arrange(desc(mean_score)) %>%
  ggplot() +
  geom_bar(aes(x=reorder(main_genre, -mean_score), y=mean_score, fill = main_genre), stat="identity") +
  labs(title = "All Main Genres by Mean Review Score", x="Main Genre", y="Mean Review Score") +
  theme(axis.text.x = element_text(size = 10, angle = 60, hjust = 1)) + 
  guides(fill = FALSE)
```

```{r}
ign[ign$main_genre == 'Hardware',]
```

```{r}
ign %>%
  group_by(main_genre) %>%
  summarise(games_count = n()) %>%
  arrange(desc(games_count)) %>%
  ggplot() +
  geom_bar(aes(x=reorder(main_genre, -games_count), y=games_count, fill = main_genre), stat="identity") +
  labs(title = "All Main Genres by Total Number of Games", x="Main Genre", y="Total Number of Games") +
  theme(axis.text.x = element_text(size = 10, angle = 60, hjust = 1)) + 
  guides(fill = FALSE)
```

Group by Title

By looking at unique titles, there are 6033 titles, around 1/3 of the total that repeat. We will create a new dataframe that ignores the platform that they are on and focuses on the title.
```{r}
length(ign$title) - length(unique(ign$title))
```

Using grepl to filter by string in a title
```{r}
ign %>%
  filter(., grepl("LittleBigPlanet", title))
```

```{r}
grouped_title_ign <- ign %>%
  group_by(title) %>%
  summarise(score = round(mean(score),1), release_year = first(release_year), count=n(), main_genre = first(main_genre))

tail(grouped_title_ign, limit=5)
```

Top genres again after grouping
```{r}
grouped_title_ign %>%
  group_by(main_genre) %>%
  summarise(mean_score = round(mean(score),2)) %>%
  ggplot() +
  geom_bar(stat="identity", aes(x=reorder(main_genre, -mean_score), y=mean_score, fill = main_genre)) +
  guides(fill = FALSE) +
  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1)) + 
  labs(title = "All Main Genres by Mean Review Score (After Grouping)", x="Main Genre", y="Mean Review Score")
```

Top genres by game count
```{r}

```


```{r}
grouped_title_ign %>%
  arrange(desc(count)) %>%
  tail()
```

Most represented game across platforms
```{r}
grouped_title_ign %>%
  arrange(desc(count)) %>%
  subset(., count>=8) %>%
  ggplot() +
  geom_bar(aes(x=reorder(title, -count), y=count, fill=title), stat="identity") +
  geom_label(aes(x=reorder(title, -count), y=count, label=count)) + 
  theme(axis.text.x = element_text(size = 8, angle = 45, hjust = 1)) +
  guides(fill=FALSE) +
  labs(title = "Top Represented Titles Across Platforms", x="Title", y="Number of Platforms")
```

Top rated titles
```{r}
subset(grouped_title_ign, score==10)
```

Charts to try:
1. Lollipop chart for mean review score for all genres
2. Slope chart for start and end number of games per platform
3. Box plot of mean review score across platforms
4. Waffle chart of number of games across platforms
5. Seasonal plot of annual game number releases across platforms

Development of platforms over time by cumulative growth in titles
```{r}

```


```{r}

```

